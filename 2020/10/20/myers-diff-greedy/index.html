<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />



  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">






  <meta name="keywords" content="Diff," />










<meta name="description" content="最初不知道是什么时候发现 DiffUtil 对比列表 item 数据进行局部刷新，git 文件对比都用到了这个算法。上个月刚好再一次看到了就想深入了解一下。但发现发现国内的博客和帖子，对这个算法的讲述内容比较少，每篇文章都讲述了作者自己认为重要的内容，所以有一个点搞不懂的话没法整体性的进行理解。刚开始我自己就有一个点没想清楚想了好几天，我觉得程序员不能怕算法，书读百遍其义自现，阅读算法代码也是如此">
<meta name="keywords" content="Diff">
<meta property="og:type" content="article">
<meta property="og:title" content="Myers‘Diff之贪婪算法">
<meta property="og:url" content="http://yoursite.com/2020/10/20/myers-diff-greedy/index.html">
<meta property="og:site_name" content="下雨天要逛街">
<meta property="og:description" content="最初不知道是什么时候发现 DiffUtil 对比列表 item 数据进行局部刷新，git 文件对比都用到了这个算法。上个月刚好再一次看到了就想深入了解一下。但发现发现国内的博客和帖子，对这个算法的讲述内容比较少，每篇文章都讲述了作者自己认为重要的内容，所以有一个点搞不懂的话没法整体性的进行理解。刚开始我自己就有一个点没想清楚想了好几天，我觉得程序员不能怕算法，书读百遍其义自现，阅读算法代码也是如此">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201012200724264.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0dmVuX2tpbmc=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201009164930993.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0dmVuX2tpbmc=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201009170750344.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0dmVuX2tpbmc=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201009192930777.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0dmVuX2tpbmc=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20201010102738607.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0dmVuX2tpbmc=,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:updated_time" content="2022-02-09T08:29:58.113Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Myers‘Diff之贪婪算法">
<meta name="twitter:description" content="最初不知道是什么时候发现 DiffUtil 对比列表 item 数据进行局部刷新，git 文件对比都用到了这个算法。上个月刚好再一次看到了就想深入了解一下。但发现发现国内的博客和帖子，对这个算法的讲述内容比较少，每篇文章都讲述了作者自己认为重要的内容，所以有一个点搞不懂的话没法整体性的进行理解。刚开始我自己就有一个点没想清楚想了好几天，我觉得程序员不能怕算法，书读百遍其义自现，阅读算法代码也是如此">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20201012200724264.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0dmVuX2tpbmc=,size_16,color_FFFFFF,t_70#pic_center">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/10/20/myers-diff-greedy/"/>





  <title>Myers‘Diff之贪婪算法 | 下雨天要逛街</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?1055a4e1d37a3a4dcb3a3e1c4f32f147";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>
    <a href="https://github.com/stven0king" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">下雨天要逛街</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/20/myers-diff-greedy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="振兴">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/jay.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="下雨天要逛街">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Myers‘Diff之贪婪算法</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-10-20T16:55:35+08:00">
                2020-10-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Arithmetic/" itemprop="url" rel="index">
                    <span itemprop="name">Arithmetic</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/10/20/myers-diff-greedy/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/10/20/myers-diff-greedy/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          
              <div class="post-description">
                  最初不知道是什么时候发现 DiffUtil 对比列表 item 数据进行局部刷新，git 文件对比都用到了这个算法。上个月刚好再一次看到了就想深入了解一下。但发现发现国内的博客和帖子，对这个算法的讲述内容比较少，每篇文章都讲述了作者自己认为重要的内容，所以有一个点搞不懂的话没法整体性的进行理解。刚开始我自己就有一个点没想清楚想了好几天，我觉得程序员不能怕算法，书读百遍其义自现，阅读算法代码也是如此，平时多思考偶尔的一点灵光出现会减少你死磕算法浪费的时间。 
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Myers’Diff"><a href="#Myers’Diff" class="headerlink" title="Myers’Diff"></a>Myers’Diff</h1><p><img src="https://img-blog.csdnimg.cn/20201012200724264.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0dmVuX2tpbmc=,size_16,color_FFFFFF,t_70#pic_center" alt="美图"></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>写这篇文章已经拖了很久了，因为一直在准备后续的 <a href="https://dandanlove.blog.csdn.net/article/details/108996040" target="_blank" rel="noopener">Myers‘Diff之线性空间细化</a> 。最初不知道是什么时候发现 <code>DiffUtil</code> 对比列表 <code>item</code> 数据进行局部刷新，<code>git</code> 文件对比都用到了这个算法。上个月刚好再一次看到了就想深入了解一下。但发现发现国内的博客和帖子，对这个算法的讲述内容比较少，每篇文章都讲述了作者自己认为重要的内容，所以有一个点搞不懂的话没法整体性的进行理解。刚开始我自己就有一个点没想清楚想了好几天，我觉得程序员不能怕算法，书读百遍其义自现，阅读算法代码也是如此，平时多思考偶尔的一点灵光出现会减少你死磕算法浪费的时间。</p>
<h2 id="Myer差分算法"><a href="#Myer差分算法" class="headerlink" title="Myer差分算法"></a>Myer差分算法</h2><p>举一个最常见的例子，我们使用 <code>git</code> 进行提交时，通常会查看这次提交做了哪些改动，这里我们先简单定义一下什么是 <code>diff</code> ：<code>diff</code> 就是目标文本和源文本之间的区别，也就是将源文本变成目标文本所需要的操作。<code>Myers算法</code> 由 <code>Eugene W.Myers</code> 在 <code>1986</code> 年发表在 <code>《 Algorithmica》</code> 杂志上。的一篇<a href="http://xmailserver.org/diff2.pdf" target="_blank" rel="noopener">论文</a>中提出，是一个能在大部分情况产生<strong>最短的直观的diff</strong> 的一个算法。</p>
<p><img src="https://img-blog.csdnimg.cn/20201009164930993.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0dmVuX2tpbmc=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><strong>寻找最短的直观的diff</strong> 是一个非常模糊的问题，首先，我们需要把这个问题抽象为一个具体的数学问题，然后再来寻找算法解决。</p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><ul>
<li><p>File A and File B</p>
<blockquote>
<p>The diff algorithm takes two files as input. The first, usually older, one is file A, and the second one is file B. The algorithm generates instructions to turn file A into file B.(diff算法将两个文件作为输入。第一个通常是较旧的文件是文件A，第二个是文件B。算法生成指令以将文件A转换为文件B。)</p>
</blockquote>
</li>
<li><p>Shortest Edit Script ( SES )</p>
<blockquote>
<p>The algorithm finds the Shortest Edit Script that converts file A into file B. The SES contains only two types of commands: deletions from file A and insertions in file B.(该算法找到将文件A转换为文件B的最短编辑脚本。SES仅包含两种类型的命令：从文件A删除和在文件B中插入。)</p>
</blockquote>
</li>
<li><p>Longest Common Subsequence ( LCS )</p>
<blockquote>
<p>Finding the SES is equivalent to finding the Longest Common Subsequence of the two files. The LCS is the longest list of characters that can be generated from both files by removing some characters. The LCS is distinct from the Longest Common Substring, which has to be contiguous.(查找SES等同于找到两个文件的最长公共子序列。 LCS是可以通过删除某些字符从两个文件生成的最长字符列表。 LCS与最长公共子字符串不同，后者必须是连续的。)</p>
</blockquote>
</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>本文使用与本文相同的示例。文件<code>A</code>包含 <code>ABCABBA</code>，文件<code>B</code>包含<code>CBABAC</code>。这些被表示为两个字符数组：<code>A []</code>和<code>B []</code>。<br><code>A []</code>的长度为<code>N</code>，<code>B []</code>的长度为<code>M</code>。</p>
<p>我们就可以求解从<code>A数组</code>变成<code>B数组</code>的问题，转换成为求解从<code>A字符串</code>变成<code>B字符串</code>的问题（将抽象问题具现）。</p>
<p><img src="https://img-blog.csdnimg.cn/20201009170750344.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0dmVuX2tpbmc=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><code>数组A</code>沿<code>x轴</code>放在顶部。<code>数组B</code>沿<code>y轴</code>向下放置。</p>
<p>PS:文章中的图都是由<a href="https://www.codeproject.com/KB/recipes/DiffTutorial_2/DiffTutorial_bin.zip" target="_blank" rel="noopener">DiffTutorial</a>软件制作而成，该应用程序是一种学习辅助工具。它显示算法各个阶段的图形表示。</p>
<p>解决方案：从<code>左上角（0，0）</code>到<code>右下角（7，6）</code>的最短路径。 您始终可以水平或垂直移动一个字符。水平<code>（右）</code>移动表示从<code>文件A</code>中删除，垂直<code>（向下）</code>移动表示在<code>文件B</code>中插入。如果存在匹配的字符，则还可以对角移动，以匹配结束。 解决方案是包含最多对角线的迹线。 <code>LCS</code>是轨迹中的对角线，<code>SES</code>是轨迹中的水平和垂直移动。例如，<code>LCS</code>的长度为4个字符，<code>SES</code>的长度为5个差异。</p>
<blockquote>
<p>snake: 一条snake代表走一步。例如从(0,0)-&gt;(0,1) / (0,0)-&gt;(1,0) / (0,1)-&gt;(0,2)-&gt;(2,4) 这分别为三条snake，走对角线不计入步数。</p>
</blockquote>
<blockquote>
<p>k line: k lines表示长的对角线，其中每个k = x - y。假设一个点m(m,n),那么它所在的k line值为m - n。</p>
</blockquote>
<blockquote>
<p>d contour: 每条有效路径(能从(0,0)到(m,n)的路径都称为有效路径)的步数。形象点，一条path有多个snake组成，这里d contours表示snake的个数。</p>
</blockquote>
<h2 id="贪婪算法"><a href="#贪婪算法" class="headerlink" title="贪婪算法"></a>贪婪算法</h2><p>该算法是迭代的。它计算连续 <code>d</code> 的每条 <code>k</code> 线上最远的到达路径。当路径到达右下角时，将找到解决方案。</p>
<blockquote>
<p>这里面有很重要的几点：</p>
<ol>
<li>路径的终点必然在<code>k</code>线上。迭代进行，所以<code>k</code>线的上一步操作是<code>k+1</code>向下移动或者<code>k-1</code>向右移动；</li>
<li>计算连续的<code>d</code>每条<code>k</code>线上最远的到达路径（偶数<code>d</code>的端点在偶数<code>k</code>线，奇数类似）；</li>
<li>路径到达右下角结束；</li>
</ol>
<p>其中1和2都是在论文中进行了证明~！</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20201009192930777.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0dmVuX2tpbmc=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<ul>
<li><code>k line</code>：棕色线是k的奇数值的k条线。黄线是k的偶数值的k线。 </li>
<li><code>snake</code>：深蓝色的线条是蛇。红蛇显示溶液痕迹。 </li>
<li><code>d contours</code>：淡蓝色的线是差异轮廓。例如，标记为“ 2”的直线上的三个端点全部具有2个水平或垂直移动。</li>
</ul>
<h3 id="外循环次数"><a href="#外循环次数" class="headerlink" title="外循环次数"></a>外循环次数</h3><p>从（x、y）组成的矩形<code>左上角</code>，到<code>右下角</code>。最长的路径莫过于所有对角线都不经过。也就是只走<code>X</code>和<code>Y</code>的长度即<code>最大长度=N+M</code>。<br><figure class="highlight plain"><figcaption><span>( int d </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">### 内循环的次数</span><br><span class="line">在此循环内，我们必须为每条`k线`找到最远的到达路径。对于给定的`d`，只能到达的`k线`位于`[-d .. + d]`范围内。当所有移动都向下时，`k = -d` 是可能的；当所有移动都在右侧时，`k = + d` 是可能的。</span><br><span class="line">```for ( int k = -d ; k &lt;= d ; k += 2 )</span><br></pre></td></tr></table></figure></p>
<p>看到这里也许就有人产生疑问，为什么是<code>k+=2</code>。</p>
<blockquote>
<p>这块有一个优化，文章前面说过<code>偶数</code>d<code>的端点在偶数</code>k<code>线，奇数类似</code>。<br>解释：移动奇数步长（前进或者后退都行）最终位置一定在奇数的<code>k线</code>上，偶数步长的最终位置一定在偶数的<code>k线</code>上。<br>PS：这里让我纠结了好长时间，最后一下几点思考让我想的更加清楚：</p>
<ol>
<li>从<code>零</code>开始一步一步在<code>k线</code>上进行移动，一定是从<code>零</code>开始。</li>
<li>这里的计算不是偶数加偶数得到的还是偶数，奇数加奇数得到的数是奇数或者偶数（这里是计算多个<code>+1或-1</code>）。</li>
<li>无论偶数还是奇数<code>+1或-1</code>之后都会改变自己的奇偶性，所以<code>d</code>次操作之后的奇偶性由<code>d</code>的奇偶进行决定。由因为起点为偶数<code>零</code>，所以说<code>偶数</code>d<code>的端点在偶数</code>k<code>线，奇数类似</code>。</li>
</ol>
</blockquote>
<h3 id="举例说明（d-3）"><a href="#举例说明（d-3）" class="headerlink" title="举例说明（d=3）"></a>举例说明（d=3）</h3><p>从<code>d = 3</code>的示例进行研究，这意味着<code>k</code>的取值范围是<code>[-3，-1，1，3]</code>。为了帮助您，我将示例中的<code>snake</code>的端点转录到下表中：<br><img src="https://img-blog.csdnimg.cn/20201010102738607.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N0dmVuX2tpbmc=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<blockquote>
<p>k = -3：这种情况下，只有当k = -2，d = 2时，向下移动一步(k = -4, d = 2这种情况不存在)。所以，我们可以这么来走，从(2,4)点开始向下走到(2,5),由于(2,5)和(3,6)之间存在一个对角线，可以走到(3,6)。所以着整个snake是：(2,4) -&gt; (2,5) -&gt; (3,6)。</p>
</blockquote>
<blockquote>
<p>k = -1：当k = -1时，有两种情况需要来讨论：分别是k = 0，d = 2向下走；k = -2 ，d = 2向右走。</p>
<ul>
<li>当k = 0，d = 2时，是(2,2)点。所以当从(2,2)点向下走一步，到达(2,3),由于(2,3)没有对角线连接，所以整个snake是：(2,2) -&gt; (2,3)。</li>
<li>当k = -2 ，d = 2时，是(2,4)点。所以当从(2,4)点向右走一步，到达(3,4)，由于(3,4)与(4,5)存在对角线，所以整个snake是：(2,4) -&gt; (3,4) -&gt; (4,5)。</li>
</ul>
<p>在整个过程中，存在两条snake，我们选择是沿着k line走的最远的snake，所以选择第二条snake。</p>
</blockquote>
<blockquote>
<p>k = 1：当k = 1时，存在两种可能性，分别是从k = 0向右走一步，或者k = 2向下走一步，我们分别来讨论一下。</p>
<ul>
<li>当k = 0，d = 2时，是(2,2)点。所以当从(2,2)向右走一步，到达(3,2),由于(3,2)与(5,4)存在对角线，所以整个snake是：(2,2) -&gt;(3,2) -&gt;(5,4)。</li>
<li>当k = 2，d = 2时，是(3,1)点。所以当从(3,1)向下走一步，到达(3,2)。所以这个snake是：(3,1) -&gt;(3,2) -&gt;(5,4)。</li>
</ul>
<p>在整个过程中，存在两条snake，我们选择起点x值较大的snake，所以是：(3,1) -&gt;(3,2) -&gt;(5,4)。</p>
</blockquote>
<blockquote>
<p>k = 3：这种情况下，(k = 4， d = 2)是不可能的，所以我们必须在(k = 2，d = 2)时向右移动一步。当k = 2, d = 2时， 是(3,1)点。所以从(3,1)点向右移动一步是(4,1)点。所以整个snake是：(3,1) -&gt; (4,1) -&gt; (5,2).</p>
</blockquote>
<h3 id="算法实现"><a href="#算法实现" class="headerlink" title="算法实现"></a>算法实现</h3><p>我们有两个循环，我们需要一个数据结构。<br>请注意，<code>d（n）</code>的解仅取决于<code>d（n-1）</code>的解。还请记住，对于<code>d</code>的偶数值，我们在偶数<code>k行</code>上找到端点，而这些端点仅取决于全部在奇数k行上的先前端点。对于<code>d</code>的奇数值也是如此。<br>我们使用称为<code>V</code>的数组，其中<code>k</code>为索引，终点的<code>x</code>位置为值。我们不需要存储<code>y</code>位置，因为我们可以根据<code>x</code>和<code>k</code>来计算它：<code>y = x-k</code>。同样，对于给定的<code>d</code>，<code>k</code>在<code>[-d .. d]</code>范围内。</p>
<figure class="highlight plain"><figcaption><span>down </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果`k = -d`，我们一定是向下移动了；如果`k = d`，我们一定是向右移动了。</span><br><span class="line">对于正常的中间情况，我们选择从`x`值较大的任何相邻行开始。这保证了我们到达`k`线上尽可能远的点。</span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line">V[ 1 ] = 0;</span><br><span class="line">for ( int d = 0 ; d &lt;= N + M ; d++ )//外循环，进行多少次代表有多少个snake和V数组</span><br><span class="line">&#123;</span><br><span class="line">  for ( int k = -d ; k &lt;= d ; k += 2 )//内循环</span><br><span class="line">  &#123;</span><br><span class="line">    // down or right?</span><br><span class="line">    bool down = ( k == -d || ( k != d &amp;&amp; V[ k - 1 ] &lt; V[ k + 1 ] ) );</span><br><span class="line">    int kPrev = down ? k + 1 : k - 1;//如果向下，那么上一步应该是k+1</span><br><span class="line">    // start point，上一个点</span><br><span class="line">    int xStart = V[ kPrev ];//v[k]=x</span><br><span class="line">    int yStart = xStart - kPrev;//y=x-k</span><br><span class="line">    // mid point，下一个点</span><br><span class="line">    int xMid = down ? xStart : xStart + 1;</span><br><span class="line">    int yMid = xMid - k;</span><br><span class="line">    // end point</span><br><span class="line">    int xEnd = xMid;</span><br><span class="line">    int yEnd = yMid;</span><br><span class="line">    // follow diagonal</span><br><span class="line">    int snake = 0;//是否有对角线继续往重点走</span><br><span class="line">    while ( xEnd &lt; N &amp;&amp; yEnd &lt; M &amp;&amp; A[ xEnd ] == B[ yEnd ] ) </span><br><span class="line">    &#123; </span><br><span class="line">    	xEnd++; yEnd++; snake++; </span><br><span class="line">   	&#125;</span><br><span class="line">    // save end point</span><br><span class="line">    V[ k ] = xEnd;</span><br><span class="line">    // check for solution</span><br><span class="line">    if ( xEnd &gt;= N &amp;&amp; yEnd &gt;= M ) /* solution has been found */</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码寻找一条到达终点的<code>snake</code>。因为<code>V数组</code>里面存储的是在<code>k line</code>最新端点的坐标，所以为了寻找到所有的<code>snake</code>，我们在<code>d</code>的每次循环完毕之后，从<code>d(Solution)遍历到0</code>。如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">IList&lt;V&gt; Vs; <span class="comment">// saved V's indexed on d</span></span><br><span class="line">IList&lt;Snake&gt; snakes; <span class="comment">// list to hold solution</span></span><br><span class="line"><span class="comment">//从后往前推，最后一条snake是到达终点必须经过的路线。</span></span><br><span class="line">POINT p = <span class="keyword">new</span> POINT( N, M ); <span class="comment">// start at the end</span></span><br><span class="line"><span class="keyword">for</span> ( <span class="keyword">int</span> d = vs.Count - <span class="number">1</span> ; p.X &gt; <span class="number">0</span> || p.Y &gt; <span class="number">0</span> ; d-- )</span><br><span class="line">&#123;</span><br><span class="line">  var V = Vs[ d ];<span class="comment">//内循环产生的数据</span></span><br><span class="line">  <span class="keyword">int</span> k = p.X - p.Y;<span class="comment">//本次循环的起点的k线</span></span><br><span class="line">  <span class="comment">// end point is in V</span></span><br><span class="line">  <span class="keyword">int</span> xEnd = V[ k ];</span><br><span class="line">  <span class="keyword">int</span> yEnd = x - k;</span><br><span class="line">  <span class="comment">// down or right?</span></span><br><span class="line">  <span class="keyword">bool</span> down = ( k == -d || ( k != d &amp;&amp; V[ k - <span class="number">1</span> ] &lt; V[ k + <span class="number">1</span> ] ) );</span><br><span class="line">  <span class="keyword">int</span> kPrev = down ? k + <span class="number">1</span> : k - <span class="number">1</span>;<span class="comment">//上一个snake的k线</span></span><br><span class="line">  <span class="comment">// start point</span></span><br><span class="line">  <span class="keyword">int</span> xStart = V[ kPrev ];</span><br><span class="line">  <span class="keyword">int</span> yStart = xStart - kPrev;</span><br><span class="line">  <span class="comment">// mid point</span></span><br><span class="line">  <span class="keyword">int</span> xMid = down ? xStart : xStart + <span class="number">1</span>;<span class="comment">//中间点</span></span><br><span class="line">  <span class="keyword">int</span> yMid = xMid - k;</span><br><span class="line">  snakes.Insert( <span class="number">0</span>, <span class="keyword">new</span> Snake( <span class="comment">/* start, mid and end points */</span> ) );</span><br><span class="line">  p.X = xStart;</span><br><span class="line">  p.Y = yStart;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>时间复杂度: 期望为<code>O(M+N+D^2)</code>，最坏情况为为<code>O((M+N)D)</code> 。</p>
<p>有兴趣的可以继续阅读下一篇文章 <a href="https://dandanlove.blog.csdn.net/article/details/108996040" target="_blank" rel="noopener">Myers‘Diff之线性空间细化</a> 。</p>
<p>算法实践：<a href="https://dandanlove.blog.csdn.net/article/details/109123553" target="_blank" rel="noopener">DiffUtil和它的差量算法</a></p>
<p>参考链接：<br><a href="https://github.com/google/diff-match-patch" target="_blank" rel="noopener">代码:diff-match-patch</a><br><a href="http://xmailserver.org/diff2.pdf" target="_blank" rel="noopener">diff2论文</a><br><a href="https://www.codeproject.com/Articles/42279/Investigating-Myers-diff-algorithm-Part-1-of-2" target="_blank" rel="noopener">Myers diff alogrithm:part 1</a><br><a href="https://www.codeproject.com/Articles/42280/Investigating-Myers-Diff-Algorithm-Part-2-of-2" target="_blank" rel="noopener">Myers diff alogrithm:part 2</a></p>
<p>文章到这里就全部讲述完啦，若有其他需要交流的可以留言哦~！~！</p>

      
    </div>
    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/images/dskb-dhz-icon-0.5.jpg" alt="振兴 wechat" style="width: 200px; max-width: 100%;"/>
    <div>欢迎您扫一扫上面的微信公众号，订阅我的博客！</div>
</div>

      </div>
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/weixinpay.jpeg" alt="振兴 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpeg" alt="振兴 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    振兴
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://yoursite.com/2020/10/20/myers-diff-greedy/" title="Myers‘Diff之贪婪算法">http://yoursite.com/2020/10/20/myers-diff-greedy/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Diff/" rel="tag"><i class="fa fa-tag"></i> Diff</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/07/07/startup-runtime/" rel="next" title="App Startup 源码分析">
                <i class="fa fa-chevron-left"></i> App Startup 源码分析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/10/20/myers-diff-od/" rel="prev" title="Myers'Diff之线性空间细化">
                Myers'Diff之线性空间细化 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/jay.jpg"
                alt="振兴" />
            
              <p class="site-author-name" itemprop="name">振兴</p>
              <p class="site-description motion-element" itemprop="description">好好学习，天天向上</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">95</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">120</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/stven0king" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://me.csdn.net/stven_king" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-crosshairs"></i>CSDN</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.jianshu.com/u/311540b7592b" target="_blank" title="简书">
                      
                        <i class="fa fa-fw fa-book"></i>简书</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://juejin.im/user/56824a1900b01b9f2bd94ae8" target="_blank" title="掘金">
                      
                        <i class="fa fa-fw fa-spinner"></i>掘金</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/2520114671/profile?rightmod=1&wvr=6&mod=personinfo" target="_blank" title="微博">
                      
                        <i class="fa fa-fw fa-weibo"></i>微博</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:stven0king@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                推荐阅读
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://gityuan.com/" title="Gityuan" target="_blank">Gityuan</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.wanandroid.com/index" title="玩Android" target="_blank">玩Android</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.wjdiankong.cn/" title="尼古拉斯.赵四" target="_blank">尼古拉斯.赵四</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Myers’Diff"><span class="nav-number">1.</span> <span class="nav-text">Myers’Diff</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Myer差分算法"><span class="nav-number">1.2.</span> <span class="nav-text">Myer差分算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#定义"><span class="nav-number">1.2.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#示例"><span class="nav-number">1.2.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#贪婪算法"><span class="nav-number">1.3.</span> <span class="nav-text">贪婪算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#外循环次数"><span class="nav-number">1.3.1.</span> <span class="nav-text">外循环次数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#举例说明（d-3）"><span class="nav-number">1.3.2.</span> <span class="nav-text">举例说明（d=3）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#算法实现"><span class="nav-number">1.3.3.</span> <span class="nav-text">算法实现</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">振兴</span>

  
</div>



<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
</div>

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>


<!--

  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>



-->
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: '7mQEfpQKgyuazaGg5Q6mejuC-gzGzoHsz',
        appKey: '0Tz7vXbTHfHnIslfjQNPbAg0',
        placeholder: 'Just go go',
        avatar:'wavatar',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
